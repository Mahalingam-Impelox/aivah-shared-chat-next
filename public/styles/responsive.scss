// Enhanced Responsive Design System - Mobile First
@import "~bootstrap/scss/_mixins";
@import "~bootstrap/scss/_variables";

// Enhanced breakpoints for modern devices
$breakpoints: (
  'xs': 0,
  'sm': 576px,
  'md': 768px,
  'lg': 992px,
  'xl': 1200px,
  'xxl': 1400px,
  'mobile-portrait': 480px,
  'mobile-landscape': 768px,
  'tablet-portrait': 768px,
  'tablet-landscape': 1024px,
  'desktop': 1200px,
  'desktop-large': 1600px
);

// Device-specific breakpoints
$mobile-max: 767px;
$tablet-min: 768px;
$tablet-max: 1023px;
$desktop-min: 1024px;

// Safe area support variables
:root {
  --safe-area-inset-top: env(safe-area-inset-top, 0);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0);
  --safe-area-inset-left: env(safe-area-inset-left, 0);
  --safe-area-inset-right: env(safe-area-inset-right, 0);
  
  // Responsive spacing
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-xxl: 3rem;
  
  // Responsive typography
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-md: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;
  --font-size-xxl: 1.5rem;
  
  // Mobile-optimized sizes
  --mobile-font-size-xs: 0.7rem;
  --mobile-font-size-sm: 0.8rem;
  --mobile-font-size-md: 0.9rem;
  --mobile-font-size-lg: 1rem;
  --mobile-font-size-xl: 1.1rem;
  --mobile-font-size-xxl: 1.3rem;
  
  // Touch targets
  --touch-target-min: 44px;
  --touch-target-comfortable: 48px;
  
  // Z-index layers
  --z-index-dropdown: 1000;
  --z-index-sticky: 1020;
  --z-index-fixed: 1030;
  --z-index-modal-backdrop: 1040;
  --z-index-modal: 1050;
  --z-index-popover: 1060;
  --z-index-tooltip: 1070;
  --z-index-toast: 1080;
  --z-index-mobile-nav: 9999;
}

// Mixins for responsive breakpoints
@mixin mobile-only {
  @media (max-width: #{$mobile-max}) {
    @content;
  }
}

@mixin tablet-only {
  @media (min-width: #{$tablet-min}) and (max-width: #{$tablet-max}) {
    @content;
  }
}

@mixin desktop-only {
  @media (min-width: #{$desktop-min}) {
    @content;
  }
}

@mixin mobile-and-tablet {
  @media (max-width: #{$tablet-max}) {
    @content;
  }
}

@mixin tablet-and-desktop {
  @media (min-width: #{$tablet-min}) {
    @content;
  }
}

// Device orientation mixins
@mixin portrait {
  @media (orientation: portrait) {
    @content;
  }
}

@mixin landscape {
  @media (orientation: landscape) {
    @content;
  }
}

// High DPI / Retina display support
@mixin retina {
  @media (-webkit-min-device-pixel-ratio: 2),
         (min-resolution: 192dpi),
         (min-resolution: 2dppx) {
    @content;
  }
}

// Touch device optimizations
@mixin touch-device {
  @media (hover: none) and (pointer: coarse) {
    @content;
  }
}

@mixin mouse-device {
  @media (hover: hover) and (pointer: fine) {
    @content;
  }
}

// Reduced motion support
@mixin reduce-motion {
  @media (prefers-reduced-motion: reduce) {
    @content;
  }
}

// Dark mode support
@mixin dark-mode {
  @media (prefers-color-scheme: dark) {
    @content;
  }
}

// High contrast support
@mixin high-contrast {
  @media (prefers-contrast: high) {
    @content;
  }
}

// Base mobile-first styles
// All styles are mobile-first, then enhanced for larger screens

// Mobile-optimized base styles
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  
  // Allow text selection where needed
  &[contenteditable="true"],
  &.selectable {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
  }
}

// Input elements should allow selection
input,
textarea,
select,
button {
  -webkit-user-select: auto;
  -moz-user-select: auto;
  -ms-user-select: auto;
  user-select: auto;
}

// Text elements should allow selection
p,
span,
div[role="textbox"],
[contenteditable="true"] {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

html {
  // Prevent iOS zoom on input focus
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  text-size-adjust: 100%;
  
  // Smooth scrolling
  scroll-behavior: smooth;
  
  @include reduce-motion {
    scroll-behavior: auto;
  }
}

body {
  // Prevent overscroll bounce on iOS
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
  
  // Mobile-first font sizes
  font-size: var(--mobile-font-size-md);
  line-height: 1.5;
  
  @include tablet-and-desktop {
    font-size: var(--font-size-md);
  }
  
  // Prevent iOS safari address bar issues
  min-height: 100vh;
  min-height: -webkit-fill-available;
}

// Mobile-first container system
.container-mobile {
  width: 100%;
  padding: 0 var(--spacing-md);
  margin: 0 auto;
  
  @include mobile-only {
    padding: 0 var(--spacing-sm);
  }
  
  @include tablet-and-desktop {
    max-width: 1200px;
    padding: 0 var(--spacing-lg);
  }
}

// Touch-optimized button styles
.btn-touch {
  min-height: var(--touch-target-min);
  min-width: var(--touch-target-min);
  padding: var(--spacing-sm) var(--spacing-md);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  
  @include touch-device {
    min-height: var(--touch-target-comfortable);
    padding: var(--spacing-md) var(--spacing-lg);
  }
  
  @include mouse-device {
    &:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
  }
  
  &:active {
    transform: translateY(0);
  }
  
  &:focus {
    outline: 2px solid #007bff;
    outline-offset: 2px;
  }
}

// Mobile-optimized spacing utilities
.m-mobile {
  @include mobile-only {
    margin: var(--spacing-sm) !important;
  }
  
  @include tablet-and-desktop {
    margin: var(--spacing-md) !important;
  }
}

.p-mobile {
  @include mobile-only {
    padding: var(--spacing-sm) !important;
  }
  
  @include tablet-and-desktop {
    padding: var(--spacing-md) !important;
  }
}

// Safe area padding utilities
.safe-area-top {
  padding-top: var(--safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: var(--safe-area-inset-bottom);
}

.safe-area-left {
  padding-left: var(--safe-area-inset-left);
}

.safe-area-right {
  padding-right: var(--safe-area-inset-right);
}

.safe-area-all {
  padding-top: var(--safe-area-inset-top);
  padding-bottom: var(--safe-area-inset-bottom);
  padding-left: var(--safe-area-inset-left);
  padding-right: var(--safe-area-inset-right);
}

// Mobile-specific layout utilities
.mobile-stack {
  @include mobile-only {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  @include tablet-and-desktop {
    display: flex;
    flex-direction: row;
    gap: var(--spacing-md);
  }
}

.mobile-hide {
  @include mobile-only {
    display: none !important;
  }
}

.mobile-show {
  display: none !important;
  
  @include mobile-only {
    display: block !important;
  }
}

.tablet-hide {
  @include tablet-only {
    display: none !important;
  }
}

.desktop-hide {
  @include desktop-only {
    display: none !important;
  }
}

// Mobile-optimized typography
.text-mobile {
  @include mobile-only {
    font-size: var(--mobile-font-size-sm);
    line-height: 1.4;
  }
  
  @include tablet-and-desktop {
    font-size: var(--font-size-md);
    line-height: 1.5;
  }
}

.heading-mobile {
  @include mobile-only {
    font-size: var(--mobile-font-size-xl);
    font-weight: 600;
    line-height: 1.2;
  }
  
  @include tablet-and-desktop {
    font-size: var(--font-size-xxl);
    font-weight: 700;
    line-height: 1.3;
  }
}

// Mobile-optimized form elements
.form-mobile {
  input,
  textarea,
  select {
    min-height: var(--touch-target-min);
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: var(--mobile-font-size-md);
    
    @include mobile-only {
      font-size: 16px; // Prevent iOS zoom
    }
    
    @include tablet-and-desktop {
      font-size: var(--font-size-md);
    }
    
    &:focus {
      outline: 2px solid #007bff;
      outline-offset: 2px;
      border-color: #007bff;
    }
  }
  
  label {
    font-size: var(--mobile-font-size-sm);
    font-weight: 500;
    margin-bottom: var(--spacing-xs);
    display: block;
    
    @include tablet-and-desktop {
      font-size: var(--font-size-sm);
    }
  }
}

// Mobile-optimized modal/overlay
.modal-mobile {
  @include mobile-only {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: white;
    z-index: var(--z-index-modal);
    padding: var(--safe-area-inset-top) var(--safe-area-inset-right) var(--safe-area-inset-bottom) var(--safe-area-inset-left);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  @include tablet-and-desktop {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    z-index: var(--z-index-modal);
    max-width: 90vw;
    max-height: 90vh;
    overflow-y: auto;
  }
}

// Mobile-optimized grid system
.grid-mobile {
  display: grid;
  gap: var(--spacing-sm);
  
  @include mobile-only {
    grid-template-columns: 1fr;
  }
  
  @include tablet-only {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-md);
  }
  
  @include desktop-only {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--spacing-lg);
  }
}

// Performance optimizations
.optimize-mobile {
  @include mobile-only {
    // Reduce complexity for mobile
    transform: translateZ(0); // Force GPU acceleration
    backface-visibility: hidden;
    perspective: 1000px;
    
    // Optimize scrolling
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
    
    // Reduce repaints
    will-change: transform;
  }
}

// Accessibility improvements
@include reduce-motion {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

// Focus management for mobile
.focus-mobile {
  &:focus-visible {
    outline: 2px solid #007bff;
    outline-offset: 2px;
  }
  
  @include touch-device {
    &:focus:not(:focus-visible) {
      outline: none;
    }
  }
}

// Mobile-optimized animations
@keyframes fadeInMobile {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInMobile {
  from {
    transform: translateX(-100%);
  }
  to {
    transform: translateX(0);
  }
}

.animate-mobile {
  animation: fadeInMobile 0.3s ease-out;
  
  @include reduce-motion {
    animation: none;
  }
}

// Print styles
@media print {
  .mobile-hide,
  .print-hide {
    display: none !important;
  }
  
  * {
    background: transparent !important;
    color: black !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }
} 